# `disp_base.py` ユニットテスト作成タスクリスト（改訂版）

`tests/test_01_disp_base.py` を作成するための、実行順序を考慮した具体的なタスクリストです。

## ステップ1: テストファイルの基本構造を作成

- [x] `tests/test_01_disp_base.py` ファイルを作成する。
- [x] 必要なモジュールをインポートする (`unittest`, `unittest.mock`, `PIL.Image`)。
- [x] `pigpio` と `pi0disp.utils.mylogger` をクラスデコレータとしてモック化する。
- [x] `setUpClass` で `DispBase` をインポートする。
- [x] `TestDispBase` クラスのスケルトンを `unittest.TestCase` を継承して作成する。
- [x] `if __name__ == '__main__':` ブロックを追加し、`unittest.main()` を呼び出すようにする。

## ステップ2: `setUp` と `tearDown` メソッドの実装

- [x] `setUp` メソッドを実装する。
    - [x] `pigpio.pi` のモックインスタンス (`self.mock_pi_instance`) を作成し、`connected = True` に設定する。
    - [x] `mylogger.get_logger` のモック (`mock_logger`) をセットアップする。
    - [x] テスト用のデフォルト値 (`self.default_size`, `self.default_rotation`) を定義する。
    - [x] `DispBase` のインスタンス (`self.disp_base`) を生成する。
- [x] `tearDown` メソッドを実装する。
    - [x] `self.mock_pi.reset_mock()` を呼び出す。
    - [x] `self.mock_pi_instance.reset_mock()` を呼び出す。
    - [x] `self.mock_get_logger.reset_mock()` を呼び出す。
    - [x] `self.mock_logger.reset_mock()` を呼び出す。

## ステップ3: `__init__` メソッドのテストを実装

- [x] `test_init_success` メソッドを実装する。
    - [x] `pigpio.pi()` が一度呼び出されたことを確認する。
    - [x] `self.disp_base.pi.connected` が `True` であることを確認する。
    - [x] `size` が `rotation` に応じて正しくスワップされていることを確認する。
    - [x] `_native_size` が元の `size` と一致することを確認する。
    - [x] `_rotation` が正しく設定されていることを確認する。
- [x] `test_init_pigpio_connection_error` メソッドを実装する。
    - [x] `self.mock_pi_instance.connected = False` に設定する。
    - [x] `DispBase` のインスタンス化で `RuntimeError` が発生することを `with self.assertRaises(RuntimeError):` で確認する。

## ステップ4: 各メソッドのテストを実装

- [x] `test_init_display` メソッドを実装する。
    - [x] `self.disp_base.init_display()` を呼び出す。
    - [x] ロガーの `warning` メソッドが期待されるメッセージで呼び出されたことを確認する。
- [x] `test_set_rotation` メソッドを実装する。
    - [x] `set_rotation(90)` を呼び出し、`size` がスワップされることを確認する。
    - [x] `set_rotation(0)` を呼び出し、`size` が元に戻ることを確認する。
- [x] `test_display` メソッドを実装する。
    - [x] `PIL.Image.Image` のモック (`mock_image`) を作成する。
    - [x] `self.disp_base.display(mock_image)` を呼び出す。
    - [x] `mock_image.resize()` が期待される `size` で呼び出されたことを確認する。
- [x] `test_close` メソッドを実装する。
    - [x] `test_close_connected`: `self.disp_base.close()` を呼び出し、`self.mock_pi_instance.stop()` が呼び出されることを確認する。
    - [x] `test_close_not_connected`: `self.mock_pi_instance.connected = False` に設定してから `self.disp_base.close()` を呼び出し、`self.mock_pi_instance.stop()` が呼び出されないことを確認する。