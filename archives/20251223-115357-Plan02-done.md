# `samples/robot_face_animation.py` MOODS定義リファクタリング計画書

## 1. 目的

`MOODS` の定義に見られるパラメータのパターンを抽出し、ヘルパー関数を導入することで、定義の可読性を向上させ、意図をより明確にする。

## 2. 変更内容

### 2.1. ヘルパー関数の追加

`FaceState`の定義の前に、以下の2つのヘルパー関数を追加する。これらの関数は、`FaceState`のコンストラクタに渡すためのキーワード引数の辞書を生成する。

#### `symmetrical_eyes()`

左右対称の目の状態を生成する。

```python
def symmetrical_eyes(size: float = None, openness: float = None, curve: float = None) -> dict:
    params = {}
    if size is not None:
        params['left_eye_size'] = size
        params['right_eye_size'] = size
    if openness is not None:
        params['left_eye_openness'] = openness
        params['right_eye_openness'] = openness
    if curve is not None:
        params['left_eye_curve'] = curve
        params['right_eye_curve'] = curve
        if curve != 0:
            # curveが指定されたら、目は閉じていると判断する
            params['left_eye_openness'] = 0.0
            params['right_eye_openness'] = 0.0
    return params
```

#### `wink_eye()`

片目を閉じる（ウィンク）状態を生成する。

```python
def wink_eye(side: str, curve: float) -> dict:
    params = {}
    if side not in ['left', 'right']:
        return params

    eye_prefix = f'{side}_eye'
    params[f'{eye_prefix}_curve'] = curve
    if curve != 0:
        # curveが指定されたら、目は閉じていると判断する
        params[f'{eye_prefix}_openness'] = 0.0
        
    return params
```
*`wink-r` (右ウィンク)では右目が閉じるので、`side='right'`を指定する。`wink-l` (左ウィンク)は`side='left'`。

### 2.2. `RobotFace.MOODS`の再定義

追加したヘルパー関数を使い、`RobotFace.MOODS`の定義を以下のように書き換える。辞書のアンパッキング(`**`)を利用して、ヘルパー関数が生成した辞書を`FaceState`の引数として展開する。

**変更後 (一部抜粋):**
```python
MOODS = {
    "neutral": FaceState(),
    "happy": FaceState(mouth_curve=15),
    "sad": FaceState(
        mouth_curve=-10,
        brow_tilt=-10,
        **symmetrical_eyes(size=6),
    ),
    "angry": FaceState(
        mouth_curve=-10,
        brow_tilt=25,
        **symmetrical_eyes(size=6),
    ),
    "wink-r": FaceState(
        mouth_curve=15,
        **wink_eye('right', curve=1),
    ),
    "wink-l": FaceState(
        mouth_curve=15,
        **wink_eye('left', curve=1),
    ),
    "sleepy": FaceState(
        mouth_curve=15,
        **symmetrical_eyes(curve=-1),
    ),
    "smily": FaceState(
        mouth_curve=15,
        **symmetrical_eyes(curve=1),
    ),
    "surprised": FaceState(
        mouth_open=1.1,
        **symmetrical_eyes(size=6),
    ),
    "kiss": FaceState(
        mouth_open=0.85,
        **symmetrical_eyes(curve=-1),
    ),
}
```

## 3. 作業手順

1. `samples/robot_face_animation.py` の `FaceState` クラス定義の前に、`symmetrical_eyes` ヘルパー関数を定義する。
2. 同様に `wink_eye` ヘルパー関数を定義する。
3. `RobotFace.MOODS` ディクショナリの値を、新しいヘルパー関数を使った `FaceState` の呼び出しに置き換える。
4. 既存の動作が変わらないことを確認するため、手動でアニメーションを実行し、各表情が正しく表示されるか確認する。(テストコードがないため手動確認)
