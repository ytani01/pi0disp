# `tests/test_01_disp_base.py` 改善計画

`tests/test_01_disp_base.py` のコード品質と保守性を向上させるため、以下のリファクタリング案を提案します。

## 1. `test_close` メソッドの分割

現在の `test_close` メソッドは、pigpio への接続が確立している場合と、確立していない場合の2つのシナリオを同時にテストしています。
テストの単一責任の原則に基づき、これを2つの独立したテストメソッドに分割します。これにより、各テストの目的が明確になり、失敗時のデバッグが容易になります。

- **`test_close` を `test_close_calls_pi_stop_when_connected` にリネームし、`pi.connected` が `True` のケースのみをテストするように修正します。**
    - `pi.connected` が `True` の状態をセットアップします。
    - `disp_base.close()` を呼び出します。
    - `mock_pi_instance.stop()` が1回呼び出されたことをアサートします。
- **新しいテストメソッド `test_close_does_not_call_pi_stop_when_not_connected` を作成します。**
    - `pi.connected` が `False` の状態をセットアップします。
    - `disp_base.close()` を呼び出します。
    - `mock_pi_instance.stop()` が呼び出されなかったことをアサートします。

## 2. `test_display` メソッドのテストカバレッジ向上

現在の `test_display` メソッドは、画像がリサイズされるケースのみをテストしています。
画像のサイズがディスプレイのサイズと一致している場合に、`resize` が呼び出されないことを確認するテストケースを追加し、カバレッジを向上させます。

- **`test_display` を `test_display_resizes_image` にリネームします。**
- **新しいテストメソッド `test_display_with_correct_size_image` を作成します。**
    - `DispBase` をインスタンス化します。
    - ディスプレイの `size` と同じサイズの `mock_image` を作成します。
    - `disp_base.display(mock_image)` を呼び出します。
    - `mock_image.resize` が呼び出されなかったことをアサートします。
