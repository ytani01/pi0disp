# 顔表情のインタラクティブ操作機能 計画提案書

## 1. 概要

現在の `robot_face_animation.py` では、`MOODS` 辞書に定義された表情パターンを切り替えることでアニメーションを実現している。
本計画では、ユーザーがコマンドライン等から顔の各パーツ（目、眉、口）の状態を個別に、かつ簡易的に指定できるようにすることで、よりインタラクティブな表情操作を実現することを目的とする。

## 2. 現状分析

`robot_face_animation.py` の `MOODS` 定義を分析した結果、表情を構成する各パラメータ (`mouth_curve`, `brow_tilt`, `mouth_open`, `EyeState`など) は、いくつかの特徴的な値のパターンに分類できることが判明した。

- **`mouth_curve` (口の曲がり具合):** `15` (笑顔), `-10` (への字), `0` (真一文字) が主。
- **`brow_tilt` (眉の傾き):** `25` (怒り), `-10` (悲しみ), `0` (普通) が主。
- **`mouth_open` (口の開き):** `1.1` (驚き), `0.85` (キス), `0` (閉じ) が主。
- **`EyeState` (目の状態):**
    - `size` (大きさ): `8` (大), `6` (小) の2パターン。
    - `closed_curve` (閉じた目のカーブ): `1` (上向き), `-1` (下向き), `0` (直線) の3パターン。
    - `openness`: `1.0` (開), `0.0` (閉) の2パターン。

## 3. 提案内容

各パラメータの代表的な値を、1文字の簡単な記号にマッピングし、それらを組み合わせて表情を定義する新しい仕組みを導入する。

### 3.1. パラメータ記号化案

| パーツ | パラメータ | 記号 | 値 | 意味 |
| :--- | :--- | :--- | :--- | :--- |
| 口 | `mouth_curve` | `^` | 15 | 笑顔 (上向きカーブ) |
| | | `_` | 0 | 普通 (平坦) |
| | | `V` | -10 | 悲しい/怒り (下向きカーブ) |
| | `mouth_open` | `O` | 1.1 | 大きく開く (驚き) |
| | | `o` | 0.85 | 小さく開く (キス) |
| | | `-` | 0 | 閉じる |
| 眉 | `brow_tilt` | `/` | 25 | 怒り (上がり眉) |
| | | `_` | 0 | 普通 (平坦) |
| | | `\` | -10 | 悲しい (下がり眉) |
| 目 | `openness` / `size` | `O` | size=8, open | 大きい開いた目 |
| | | `o` | size=6, open | 小さい開いた目 |
| | `closed_curve` | `-` | 0 | 閉じた目 (直線) |
| | | `^` | 1 | 閉じた目 (上向きカーブ) |
| | | `v` | -1 | 閉じた目 (下向きカーブ) |

**注:** 目の状態は左右で異なる場合があるため、左右それぞれで指定する。

### 3.2. コマンドライン インターフェース案

記号化されたパラメータを、コマンドライン引数として受け取る仕組みを実装する。
変更したいパーツのみを個別に指定できる形式が、インタラクティブな操作に適していると考えられる。

**形式:**

```bash
uv run cli -- --face <left_eye><right_eye><mouth><brow>
```

**代替案 (より柔軟):**

```bash
uv run cli -- --left-eye <記号> --right-eye <記号> --mouth <記号> --brow <記号>
```

**使用例:**

- **笑顔にする:**
  ```bash
  uv run cli -- --mouth ^
  ```
- **驚いた顔にする:**
  ```bash
  uv run cli -- --left-eye o --right-eye o --mouth O
  ```
- **右目だけウィンク:**
  ```bash
  uv run cli -- --right-eye -
  ```

## 4. 実装方針

1.  **記号とパラメータ値の対応表 (マッピング辞書) を定義する。**
    - `{'^': 15, '_': 0, 'V': -10}` のような辞書を各パーツに用意する。
2.  **コマンドライン引数を解釈する関数を実装する。**
    - `click` ライブラリを使用し、`--left-eye`, `--mouth` などのオプションを追加する。
    - 引数で受け取った記号を、マッピング辞書を使って `FaceState` オブジェクトのパラメータ値に変換する。
3.  **`FaceState` を動的に生成する処理を実装する。**
    - `MOODS` のような事前定義された表情だけでなく、コマンドライン引数から動的に生成された `FaceState` を `RobotFace` に設定できるようにする。
    - `RobotFace.set_target_mood()` を拡張し、`FaceState` オブジェクトを直接受け取れるようにする。

## 5. 今後の展望

- Web UI や Bluetooth コントローラーからの入力にも対応し、リアルタイムで表情を変化させられるようにする。
- 複数の表情を組み合わせた複雑なアニメーション（例: 驚いた後に笑う）をシーケンスとして定義・実行できるようにする。

---
