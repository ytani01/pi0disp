# `tests/test_01_disp_base.py` リファクタリング タスクリスト

`Plan.md` の改善方針に基づき、以下のタスクを順番に実行する。

## ステップ1: モック管理の一元化

- [x] `tests/test_01_disp_base.py` を開き、既存のクラス `TestDispBase` を修正する。
- [x] 各テストメソッド (`test_init_success`, `test_init_pigpio_connection_error`, etc.) から `@mock.patch(...)` デコレータをすべて削除する。
- [x] 各テストメソッドのシグネチャから、モック引数 (`mock_pigpio`, `mock_get_logger`) を削除する。
- [x] `setUp` メソッドを以下のように修正する:
    - [x] `self.patcher_pigpio = mock.patch("pi0disp.disp.disp_base.pigpio")` を定義する。
    - [x] `self.patcher_logger = mock.patch("pi0disp.disp.disp_base.get_logger")` を定義する。
    - [x] `self.mock_pigpio = self.patcher_pigpio.start()` を呼び出し、モックオブジェクトをインスタンス変数に格納する。
    - [x] `self.mock_logger_getter = self.patcher_logger.start()` を呼び出し、モックオブジェクトをインスタンス変数に格納する。
    - [x] `self.addCleanup(self.patcher_pigpio.stop)` を呼び出す。
    - [x] `self.addCleanup(self.patcher_logger.stop)` を呼び出す。
    - [x] `setUp`内で`DispBase`のインスタンスを生成するコードは削除する（各テストで生成するため）。

## ステップ2: 各テストメソッドの修正

- [x] すべてのテストメソッド内で、`mock_pigpio` や `mock_get_logger` への参照を `self.mock_pigpio` や `self.mock_logger_getter` への参照に書き換える。
- [x] `test_init_success`:
    - [x] `self.mock_pigpio.pi.return_value` の設定など、モックの振る舞い設定を `setUp` からテストメソッド内に移動する。
- [x] `test_init_pigpio_connection_error`:
    - [x] 同様に、このテストケースに特化したモックの設定をテストメソッド内に記述する。
- [x] その他のテストメソッド (`test_init_display` など):
    - [x] `DispBase` のインスタンスが各メソッドの先頭で生成されることを確認する。
    - [x] 必要に応じて、`self.mock_logger_getter.return_value = self.mock_logger` のような個別のモック設定を行う。

## ステップ3: テストメソッドの分割

- [x] `test_set_rotation` メソッドを削除する。
- [x] `test_set_rotation_to_90` メソッドを新しく作成する。
    - [x] `rotation=0` で `DispBase` をインスタンス化する。
    - [x] `set_rotation(90)` を呼び出す。
    - [x] `size` が正しくスワップされたことをアサートする。
- [x] `test_set_rotation_to_0` メソッドを新しく作成する。
    - [x] `rotation=90` で `DispBase` をインスタンス化する。
    - [x] `set_rotation(0)` を呼び出す。
    - [x] `size` が元の値に戻ったことをアサートする。

## ステップ4: 最終確認

- [x] すべての修正が完了した後、`uv run pytest tests/test_01_disp_base.py` を実行し、すべてのテストがパスすることを確認する。
- [x] `mise run lint` を実行し、リンターと型チェッカーがエラーを報告しないことを確認する。
