# ST7789V RGB カラー修正計画

## 目的
ST7789V ディスプレイドライバーで観察されている RGB カラーマッピングの不正確さ、特に赤・緑・青のチャネルの入れ替わりを診断し、解決して、正確な色表現を保証します。

## 現状
- `lcd_check.py` スクリプトは一貫した色の反転を示しています。
    - 期待される赤 -> 表示される青
    - 期待される緑 -> 表示される赤
    - 期待される青 -> 表示される緑（以前の観察に基づく。純粋な青のテストで確認が必要）。
- `src/pi0disp/disp/st7789v.py` における `_bgr` フラグのチャネルスワップ実装は不十分でした。
- 回転ロジックは正しく機能していることが確認されています。

## 提案されるステップ

- [x] 1. カラー変換パイプラインの再評価:
    - [x] `src/pi0disp/disp/st7789v.py` および `src/pi0disp/utils/performance_core.py`（特に `ColorConverter`）をより深く調査します。
    - [x] PIL 画像（RGB）が RGB565 バイトに変換され、ST7789V コントローラーに送信される仕組みを理解します。
    - [x] チャネルスワッピングが発生している、または導入されている場所を特定します。

- [x] 2. ST7789V データシートの参照（利用可能またはアクセス可能な場合）:
    - [x] RGB565 および BGR565 モードの期待されるデータ形式を確認します。
    - [x] `MADCTL` レジスタの色順序（`BGR`）に関連するビットが、ディスプレイの解釈にどのように影響するかを検証します。

- [x] 3. 修正されたカラーマッピングの実装:
    - [x] 調査に基づいて、入力 RGB 値が ST7789V ディスプレイのカラー順序（RGB または BGR のいずれを期待し、565 形式をどのように処理するか）に正しくマッピングされるようにする堅牢なソリューションを実装します。
    - [x] 必要に応じて、専用のカラー補正関数を作成するか、既存の `ColorConverter` を変更することを検討します。

- [x] 4. ターゲットカラーテストの開発:
    - [x] 純粋な赤、緑、青のブロック、および白と黒を表示する簡単なスクリプトを作成するか、`lcd_check.py` を変更して、チャネルマッピングの問題を簡単に特定できるようにします。

- [x] 5. `lcd_check.py` および新規テストでの修正の検証:
    - [x] `lcd_check.py` および新規ターゲットカラーテストを実行します。
    - [x] すべての色が正しく表示されていることの視覚的確認（画像経由）を得ます。

- [x] 6. リンティングとテスト:
    - [x] 変更されたすべてのコードがリンティングと既存のテストに合格していることを確認します。

- [x] 7. 変更のコミット:
    - [x] 最終的に検証された変更を明確なメッセージと共にコミットします。

## 依存関係
- 視覚的検証のための ST7789V ディスプレイへのアクセス。
- ディスプレイ出力画像の検証のためのユーザー入力。
