# ST7789V RGB カラー修正仕様

## 概要
この仕様は、ST7789V ディスプレイドライバーにおける RGB カラーの不正確さを解決するための要件と期待される成果を詳述します。主な目標は、ST7789V ディスプレイにレンダリングされる色が入力 RGB 値を正確に反映するようにすることです。

## 問題の記述
`lcd_check.py` の視覚的検査により、赤、緑、青のカラーチャネルが不整合にマッピングまたはスワップされていることが観察されました。具体的には以下の通りです。
- 期待される赤は青として表示されます。
- 期待される緑は赤として表示されます。
- 期待される青は緑として表示されます。
- （チェッカーボードの緑の背景上の）白いテキストは水色/シアンとして表示されます。
`src/pi0disp/disp/st7789v.py` のチャネルスワッピングのための初期 `_bgr` フラグの実装では、これを完全に解決できませんでした。

## 機能要件
- **FR1:** ディスプレイドライバーは、入力 RGB（チャネルあたり8ビット）値を ST7789V ディスプレイのネイティブカラー順序（例：RGB565 または BGR565）に正しくマッピングし、正確な視覚表現を保証する必要があります。
- **FR2:** `ST7789V` クラスの `_bgr` フラグは、ディスプレイハードウェアの `MADCTL` レジスタ設定と整合するように、赤と青のチャネルの解釈を正しく制御する必要があります。
- **FR3:** すべての原色（赤、緑、青）は、レンダリングされたときに意図された色として表示される必要があります。
- **FR4:** 白と黒は、レンダリングされたときに意図された色として表示される必要があります。

## 非機能要件
- **NFR1:** ソリューションは、現在のディスプレイ性能を維持または向上させる必要があります。
- **NFR2:** コードは、既存のプロジェクトコーディング標準に準拠し、適切に文書化されている必要があります。

## 技術詳細
- **影響を受けるファイル:** `src/pi0disp/disp/st7789v.py`、場合によっては `src/pi0disp/utils/performance_core.py`。
- **主要な領域:** カラー変換ロジック、`MADCTL` レジスタ設定、`_bgr` フラグ処理。
- **診断ツール:** `lcd_check.py`（既存）、新しい単純なカラーテストスクリプト。

## 成功基準
- `lcd_check.py` および新規カラーテストスクリプトがすべての色を正確に表示していることの視覚的確認（ユーザー提供の画像経由）。
- 色の反転や不正確なカラーマッピングが観察されないこと。
- コードがすべてのリンティングと既存のテストに合格すること。