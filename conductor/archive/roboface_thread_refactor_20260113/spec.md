# Specification: roboface_thread_refactor

## Overview
`samples/roboface.py` における表情アニメーションと視線移動の処理を専用のサブスレッドに移行し、メインスレッド（CLI入力やランダムロジック）をブロックせずに滑らかな描画を実現する。また、終了処理やエラーハンドリングを強化し、信頼性の高いアプリケーション構造に刷新する。

## Functional Requirements
- **非同期アニメーションエンジン**: 
    - `AppMode` の共通機能として、表情更新および視線移動を担当する専用サブスレッドを実装する。
    - メインスレッドとサブスレッド間の通信には `queue.Queue` を使用する。
- **キューベースの制御**:
    - メインスレッドは表情の文字列をキューに投入する。
    - サブスレッドはキューから指示を取り出し、順次実行する。
    - アニメーション実行中に新しい指示が来た場合、現在の実行を完了させてから次の指示を処理する（正確性重視）。
- **既存挙動の維持**:
    - 視線移動（gaze）のアルゴリズムやタイミングは、現在の `roboface.py` の実装を忠実に継承する。
- **マルチモード対応**:
    - `RandomMode` および `InteractiveMode` の両方がこのサブスレッド構造を利用する。
- **ステータス監視**:
    - メインスレッドから、サブスレッドの稼働状況（Liveness）、アニメーション実行中フラグ、キューの滞留数を確認可能にする。

## Non-Functional Requirements
- **クリーンな終了**: 
    - プログラム終了時（正常終了・Ctrl+C等の強制中断）に、サブスレッドが確実に停止することを保証する。
- **レジリエントなエラーハンドリング**:
    - サブスレッド内でエラーが発生した場合、メインスレッドにその旨を通知（ログ出力等）し、**サブスレッドは停止せず、キューにある次のアニメーション処理を継続する**。
- **スレッドセーフ**:
    - 描画リソース（Cairo Surface等）へのアクセスが競合しないよう適切に管理する。

## Acceptance Criteria
- [ ] `roboface.py` を起動し、視線や表情の動きが従来と変わらないこと。
- [ ] インタラクティブモードにおいて、アニメーション実行中もCLI入力が受け付けられ、入力した指示がキューに追加されること。
- [ ] Ctrl+C で停止した際、スレッドの残存やリソースの解放漏れがなく、即座に終了すること。
- [ ] サブスレッドでエラーが発生した際、その情報がメインスレッド側に表示され、かつ次の表情指示が正常に処理されること。

## Out of Scope
- 新しい表情（SVG）の追加。
- Cairo 描画ロジック自体の最適化（今回はスレッド化と制御構造に集中する）。
