# Specification: `spec.md`

## Overview
`ballanime` の `optimized` および `cairo-optimized` モードにおいて、画面左上の FPS 表示の数字部分が一部欠けたり消えたりする問題を修正します。原因を特定するために、キャプチャ画像と詳細ログを用いた事実ベースの調査（憶測厳禁）を行います。

## Functional Requirements
- **FPS表示の欠損修正**: `optimized` および `cairo-optimized` モードで FPS テキストが常に正しく表示されるようにします。
- **Dirty Rectangle 処理の整合性**: FPS エリアの更新と、ボール移動に伴う背景復元・再描画ロジックの不整合（もしあれば）を解消します。

## Non-Functional Requirements
- **実装原則（憶測厳禁）**: 原因調査において推測を排除し、キャプチャ画像やログ、座標計算の事実に基づいて根本原因を突き止めます。
- **視覚的検証**: `ball-speed` を 100 程度に設定し、画面キャプチャを多用して修正前後の挙動を確認します。
- **Git運用**: 新しい専用ブランチを作成して作業を行います。

## Acceptance Criteria
- [ ] `optimized` モードで、FPS表示が欠けることなく安定して表示されること。
- [ ] `cairo-optimized` モードで、FPS表示が欠けることなく安定して表示されること。
- [ ] ボールが FPS 表示エリアを通過する際も、テキストが消えずに正しく維持されていることをキャプチャ画像で事実として確認すること。
- [ ] 修正後のコードにおいて、パフォーマンスを著しく低下させるような冗長な描画処理が導入されていないこと。

## Out of Scope
- `simple` および `cairo` モード（全画面更新モード）の修正（これらは問題が発生していない前提）。
- アニメーション自体の物理演算ロジックの変更。
