# 仕様書 (`spec.md`) - roboface3_cpu_optimization

## 1. 概要 (Overview)
`samples/roboface2.py` をベースに、その視覚的な挙動や機能を一切損なうことなく、システム全体（Pythonプロセスおよび `pigpiod`）のCPU負荷を劇的に低減させた改良版 `samples/roboface3.py` を開発する。

## 2. 機能要件 (Functional Requirements)
- **既存機能の完全維持**: `roboface2.py` で実現されている表情変化、自律的な目の動き、インタラクティブモード、ランダムモードの機能をすべて継承する。
- **後方互換性**: 設定ファイル（`.toml`）やコマンドラインオプションの互換性を維持する。
- **新規ファイル作成**: 既存の `roboface2.py` を直接変更せず、`samples/roboface3.py` として新規に作成する。

## 3. 非機能要件 (Non-Functional Requirements)
- **CPU負荷低減**: Pythonプロセス（アプリケーション側）と `pigpiod`（通信側）の両方の負荷をバランスよく低減する。
- **客観的な分析と証明**: 
    - 推測を排除し、詳細なログ出力とプロファイリングツールを用いてボトルネックを特定する。
    - `tests/test_performance.py` を用いて、改善効果を定量的に測定・証明する。
- **コード品質**: 既存のコーディング規約を遵守し、型ヒントを適切に付与する。

## 4. 受入基準 (Acceptance Criteria)
- [ ] `roboface3.py` が `roboface2.py` と同一の視覚的挙動を示すこと。
- [ ] パフォーマンステストにおいて、システム全体の平均CPU使用率が `roboface2.py` 実行時と比較して有意に低下していること。
- [ ] 詳細ログにより、各描画工程のボトルネックが解消されていることが確認できること。
- [ ] 既存の全テストケースがパスすること。

## 5. 範囲外 (Out of Scope)
- 新しい表情やパーツの追加、および既存の描画アルゴリズム（見た目）の変更。
- ハードウェア（SPIバス速度など）の物理的な変更。
