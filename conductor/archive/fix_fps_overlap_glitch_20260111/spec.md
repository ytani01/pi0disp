# Specification: `spec.md`

## Overview
`ballanime` の `optimized` および `cairo-optimized` モードにおいて、ボールが画面左上の FPS 表示（数字部分）を通過する際、ボールの移動に伴う背景復元処理によって数字が一部（あるいは全部）消えてしまう問題を修正します。

## Functional Requirements
- **FPS表示の保護**: ボールの移動による背景復元や再描画が行われた際も、FPS テキストが常に正しい状態で表示されるようにします。
- **即時再描画**: ボールが FPS 表示エリアと重なった（Dirty Rectangle が重なった）場合、FPS テキストの更新タイミングを待たずに、即座にテキストを再描画するようにします。

## Non-Functional Requirements
- **実装原則（憶測厳禁）**: 描画順序と Dirty Rectangle のマージ処理を正確に把握し、キャプチャ画像を用いて事実に基づいた修正を行います。
- **自動検証**: 修正の確認には、キャプチャ画像を用いたプログラムによる自動テスト（画像比較や特定の座標の色の確認等）を可能な限り導入し、事実に基づいて検証します。

## Acceptance Criteria
- [ ] ボールが FPS 表示エリアを通過した際、数字が欠けることなく表示され続けることを、**キャプチャ画像を用いた自動テスト**によって事実として確認すること。
- [ ] 静的解析（`mise run lint`）および既存テストをパスすること。

## Out of Scope
- `simple` および `cairo` モードの修正。
- FPS表示以外のUI改善。
