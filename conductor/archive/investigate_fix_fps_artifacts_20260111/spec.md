# Specification: `spec.md`

## Overview
`ballanime` の `optimized` および `cairo-optimized` モードにおいて、ボールが FPS 表示エリアを通過する際の表示崩れ（残像や欠け）が依然として解決されていないため、原因調査のためのキャプチャ機能を追加し、事実に基づいて根本修正を行います。

## Functional Requirements
- **キャプチャ機能の追加**: `ballanime` コマンドに `--capture-interval` (または `-C`) オプションを追加し、指定された秒数間隔で `frame_image` 全体をファイルとして保存できるようにします。
- **事実ベースの調査**: 10秒間のベンチマーク中に1秒間隔で取得したキャプチャ画像を分析し、どの工程（背景復元、ボール描画、テキスト描画）で表示が壊れているのかを事実として特定します。
- **表示ロジックの修正**: 特定された原因に基づき、Dirty Rectangle の管理および描画順序を `simple` モードと同じ結果が得られるように修正します。

## Non-Functional Requirements
- **実装原則（憶測厳禁）**: 取得したキャプチャ画像を「動かぬ証拠」として扱い、推測による修正を排除します。
- **再利用性**: 追加するキャプチャ機能は、将来のデバッグや品質検証にも役立てられるよう、一時的なパッチではなく正式なオプションとして検討します。

## Acceptance Criteria
- [ ] `--capture-interval` オプションを指定して実行した際、指定間隔で画像ファイルが正しく生成されること。
- [ ] 取得したキャプチャ画像を用いて、FPS表示が欠損または残像を残している「瞬間」の状態を特定すること。
- [ ] 修正後のコードにおいて、キャプチャされた全フレームで FPS 表示が `simple` モードと同等の品質であることを事実として確認すること。
- [ ] 静的解析（`mise run lint`）および既存テストをパスすること。

## Out of Scope
- FPS表示以外のUI改善。
- `simple` および `cairo` モードの修正（全画面描画のため問題なしと判断）。
