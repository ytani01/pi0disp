# spec.md - コードレビューに基づくアニメーションとパフォーマンスの改善

## 概要
`samples/roboface.py` におけるコードレビューの指摘事項（視線移動のFPS依存、ループのタイミング誤差、描画負荷）を修正し、アニメーションの精度向上とリソース消費の最適化を行う。

## 機能要件
1.  **時間ベースの視線補間への移行:**
    *   `lerp_factor` を固定値ではなく、経過時間（dt）に基づいた計算式に更新し、FPSの設定変更や変動に左右されない一定速度の視線移動を実現する。
2.  **ドリフト補償付きタイミングループの実装:**
    *   `time.sleep(interval)` による単純な待機から、累積誤差を補正する「Next Tick」方式のループ処理に変更し、長時間の実行でも描画タイミングがズレないようにする。

## 非機能要件
1.  **描画パフォーマンスの最適化:**
    *   `RfRenderer.render_parts` において、パディング済みの背景画像をキャッシュし、背景色やサイズに変更がない限り再利用することで、CPU負荷（特に `ImageOps.pad` と `copy` のコスト）を低減する。
2.  **事実に基づく徹底的な自動検証:**
    *   憶測を排し、デバッグログや実行時間計測（メトリクス）を用いて修正効果を「事実」として証明する。

## 受け入れ基準 (Acceptance Criteria)
*   **[最優先] パフォーマンス改善の数値証明:** 背景キャッシュ適用後の `render_parts` の平均実行時間が、初回描画時（または修正前）と比較して有意に短縮されていることが自動テストのメトリクスで示されていること。
*   **視線移動の恒常性:** 異なるFPS設定（例: 5fps と 30fps）において、同一秒数経過後の視線位置の差異が許容範囲内（5%以内）に収まっていること。
*   **タイミング精度:** 大量フレーム実行後の累積時間誤差が、設定された1フレームの間隔以内に収まっていること。
*   全自動テストがパスし、`ruff check` によるリンティングエラーがないこと。

## 対象外 (Out of Scope)
*   `samples/roboface.py` 以外のファイルにおけるパフォーマンス改善。
*   表情の記号定義（文字マップ）の変更。
