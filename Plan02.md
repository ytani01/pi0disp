## テスト計画書: `test_04_disp_conf.py`

### 1. 目的
`src/pi0disp/disp/disp_conf.py` に定義されている `DispConf` クラスの機能が期待通りに動作することを検証する。特に、設定ファイルの読み込み、プロパティの動作、およびエラーハンドリングに焦点を当てる。

### 2. テスト対象モジュール
`src/pi0disp/disp/disp_conf.py`

### 3. テストファイル名
`tests/test_04_disp_conf.py`

### 4. テスト環境
*   **言語**: Python
*   **テストフレームワーク**: `pytest`
*   **モックライブラリ**: `unittest.mock` (`MagicMock`, `patch`)

### 5. テスト対象機能とテストケースの概要

#### 5.1. `__init__` メソッド
*   **テストケース**:
    *   デフォルト引数での初期化が成功すること。
    *   カスタムファイル名での初期化が成功すること。
    *   `debug=True` で初期化された場合、ロガーがデバッグモードになっていること（モックで検証）。
    *   設定ファイルが見つからない場合に `_data` が `None` になること。
    *   不正な形式の設定ファイル（TOMLDecodeError）の場合に `_data` が `None` になること。

#### 5.2. プロパティ (`pkg_name`, `conf_filename`, `data`)
*   **テストケース**:
    *   `pkg_name` が正しいパッケージ名を返すこと。
    *   `conf_filename` が正しい設定ファイル名を返すこと。
    *   `data` が `Dynaconf` オブジェクトを返すこと（設定が正常に読み込まれた場合）。
    *   `data` が `None` を返すこと（設定が読み込まれなかった場合）。

#### 5.3. `load` メソッド
*   **テストケース**:
    *   有効な設定ファイルパスのリストとパッケージ名で設定を正常に読み込むこと。
    *   `settings_files` が `None` の場合にデフォルトパスを使用すること。
    *   `pkg_name` が `None` の場合にデフォルトパッケージ名を使用すること。
    *   不正なTOML形式のファイルパスを渡した場合に `TOMLDecodeError` が補足され `None` が返されること。

#### 5.4. `to_dict` メソッド
*   **テストケース**:
    *   設定が正常に読み込まれた場合、辞書形式で設定データが返されること。
    *   設定が読み込まれなかった場合（`_data` が `None` の場合）、`None` が返されること。

### 6. モックとフィクスチャ
*   **`Dynaconf` のモック**: `Dynaconf` クラスと `Dynaconf.get` メソッドをモックし、設定ファイルの読み込み動作をシミュレートする。
*   **`os` モジュールのモック**: `os.path.expandvars`, `os.path.expanduser` などをモックし、設定ファイルパスの解決を制御する。
*   **`mylogger` のモック**: ロギング出力を検証したり、ノイズを減らすためにモックする。
*   **設定ファイル作成のフィクスチャ**: テスト用に一時的な設定ファイル（例: `.toml` ファイル）を作成・削除するフィクスチャを用意する。

### 7. テスト実施手順
1.  `tests/test_04_disp_conf.py` ファイルを作成する。
2.  `pytest` フィクスチャ、モック、ヘルパー関数を定義する。
3.  上記「テスト対象機能とテストケースの概要」に従ってテスト関数を実装する。
4.  `uv run test tests/test_04_disp_conf.py` コマンドでテストを実行し、すべてのテストがパスすることを確認する。
